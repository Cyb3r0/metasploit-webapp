<!DOCTYPE html>
<html lang="en">
<head>
	<% include ./partials/head %>
</head>
<body class="container">
	<header>
		<% include ./partials/header %>
	</header>

	<main>
		<div class="col-lg-12">
	        <ol class="breadcrumb">
	        	<li><a href="#">Metasploit App</a></li>
	        	<li class="active">Modules</li>
	        </ol>
	        <form action="/modules" method="post" class="form-inline" align="">
				<div class="form-group">
					<input type="text" name="keyword" class="form-control" placeholder="Module Search...">
				</div>
				<button type="submit" class="btn btn-primary">Search</button>	        	
	        </form>
	        <table class="table table-hover">
	        	<thead>
	        		<tr>
		        		<th>#</th>
		        		<th>Disclosure Date</th>
		        		<th>Rank</th>
		        		<th>Name</th>
		        		<th>Path</th>
		        	</tr>
		        </thead>

		        <tbody>
		        	<% for(var Id in modules) { count = Id%>
		        	<tr class="module-<%=Id %>">
		        		<td><%= ++count %></td>
		        		<td> <%= modules[Id].disclosuredate %> </td>
		        		<td>
							<div class="stars-outer">
								<div class="stars-inner"></div>
							</div>
						</td>
		        		<td><a href="/modules/<%= modules[Id].fullname %>/new">
		        			<%= modules[Id].name%>
		        			</a>
		        		</td>
		        		<td> <%= modules[Id].fullname %> </td>
		        	</tr>
		        	<% } %>
	        	</tbody>
	        </table>
        </div>
    </main>

    <footer>
        <% include ./partials/footer %>
    </footer>

	<script>
		$(document).ready( function () {
            var modules = <%- JSON.stringify(modules) %>;
            console.log(modules);
            $.each(modules, function(i, properties){
				//console.log("key="+i+",prop="+properties.rank);
                var moduleRank = properties.rank;
                var moduleRankPoint;
                if(moduleRank == "manual"){
                    moduleRankPoint = 0;
                }else if(moduleRank == "low"){
                    moduleRankPoint = 1;
                }else if(moduleRank == "average"){
                    moduleRankPoint = 2;
                }else if(moduleRank == "normal"){
                    moduleRankPoint = 3;
                }else if(moduleRank == "good"){
                    moduleRankPoint = 4;
                }else if(moduleRank == "great"){
                    moduleRankPoint = 5;
                }else if(moduleRank == "excellent"){
                    moduleRankPoint = 6;
                }else  moduleRankPoint = null;
                //console.log("key:"+i+",point="+moduleRankPoint);
				var starPercentage = (moduleRankPoint/6) * 100;
				//console.log(i+" : "+starPercentage);
				var starPercentageRounded = `${Math.round(starPercentage / 10)*10}%`;
				//console.log(i+" rounded : "+starPercentageRounded);
				var classModule = "module-"+i;
				$("."+classModule).find(".stars-inner").css("width", starPercentageRounded);

			})
        })


	</script>

</body>
</html>